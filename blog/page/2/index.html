
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>ksauzz weblog</title>
  <meta name="author" content="ksauzz">

  
  <meta name="description" content="そろそろZeroMQを触ろうか、ということでRubyバインディングをとりあえずインストール。 ZeroMQのRubyバインディングはrbzmqとffi-rzmqがあります。
rbzmqは公式のRubyバインディングでffi-rzmqはffi版です。
ffiに関しては、さっぱり詳しくないのですが、 &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://ksauzz.github.com/blog/page/2">
  <link href="/favicon.ico" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="ksauzz weblog" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-29777654-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">ksauzz weblog</a></h1>
  
    <h2>technical note....</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:ksauzz.github.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="http://about.me/ksauzz">About</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/06/02/zmq-ruby-setup/">ZeroMQ Rubyバインディングのインストール</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-06-02T18:34:00+09:00" pubdate data-updated="true">2012-06-02 18:34</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>そろそろ<a href="http://www.zeromq.org/">ZeroMQ</a>を触ろうか、ということでRubyバインディングをとりあえずインストール。</p>

<p>ZeroMQのRubyバインディングは<a href="https://github.com/zeromq/rbzmq">rbzmq</a>と<a href="https://github.com/chuckremes/ffi-rzmq">ffi-rzmq</a>があります。
rbzmqは公式のRubyバインディングでffi-rzmqは<a href="http://www.slideshare.net/copiousfreetime/ffi-building-cross-engine-ruby-extensions">ffi</a>版です。
ffiに関しては、さっぱり詳しくないのですが、
MatzRuby使ってる分には基本rbzmqの方で良いのかなと思ってます。
ffi-rzmqをインストールしたのは<a href="https://github.com/andrewvc/learn-ruby-zeromq">learn-ruby-zeromq</a>を動かしたかった、というだけの理由です。</p>

<p>以下、MacOSでのお話…。</p>

<h2>ZeroMQのインストール</h2>

<p>とりあえずZeroMQをインストールします。
特になにも考えず現在のStable版である2.2.0を入れました。
今回はソースビルドしていて、インストール先は/usr/local/zmqです。</p>

<pre><code>git clone https://github.com/zeromq/zeromq2-x.git
cd zeromq2-x
git checkout v2.2.0
./autogen.sh
./configure --prefix=/usr/local/zmq
make
sudo make install
</code></pre>

<h2>rbzmqのインストール</h2>

<p>&#8211;with-zmq-dirでインストールパスを指定します。</p>

<pre><code>gem install zmq -- --with-zmq-dir=/usr/local/zmq
</code></pre>

<h2>ffi-rzmqのインストール</h2>

<pre><code>gem install ffi-rzmq

echo "export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:/usr/local/zmq/lib" &gt;&gt; ~/.zshrc
</code></pre>

<p>/usr/local/zmqへインストールしたので、LD_LIBRARY_PATHの指定をしておかないと実行時にコケます。</p>

<p>インストール作業は以上。</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/05/24/cowboy-client/">Cowboy clientを使う</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-05-24T20:43:00+09:00" pubdate data-updated="true">2012-05-24 20:43</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>ErlangのWebフレームワークCowboyにはcowboy_clientというクライアントモジュールが含まれています。
今回はこのcowboy_clientの基本的な使い方を紹介します。</p>

<h2>利用方法</h2>

<p>cowboy_clientは以下の流れで利用します。</p>

<ol>
<li>clientレコードの生成 (init/1)</li>
<li>接続の確立 (connect/4)</li>
<li>リクエスト送信 (request/3, request/4, request/5)</li>
<li>レスポンスヘッダーの取得 (response/1)</li>
<li>レスポンスの取得 (response_body/1)</li>
</ol>


<p>これを実際のコードで表現すると、こんな感じです。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='erlang'><span class='line'><span class="p">{</span><span class="n">ok</span><span class="p">,</span> <span class="nv">Client1</span><span class="p">}</span> <span class="o">=</span> <span class="nn">cowboy_client</span><span class="p">:</span><span class="n">init</span><span class="p">([]),</span>
</span><span class='line'><span class="p">{</span><span class="n">ok</span><span class="p">,</span> <span class="nv">Client2</span><span class="p">}</span> <span class="o">=</span> <span class="nn">cowboy_client</span><span class="p">:</span><span class="n">connect</span><span class="p">(</span><span class="n">cowboy_tcp_transport</span><span class="p">,</span> <span class="s">&quot;localhost&quot;</span><span class="p">,</span> <span class="mi">8080</span><span class="p">,</span> <span class="nv">Client1</span><span class="p">),</span>
</span><span class='line'><span class="p">{</span><span class="n">ok</span><span class="p">,</span> <span class="nv">Client3</span><span class="p">}</span> <span class="o">=</span> <span class="nn">cowboy_client</span><span class="p">:</span><span class="n">request</span><span class="p">(</span><span class="o">&lt;&lt;</span><span class="s">&quot;GET&quot;</span><span class="o">&gt;&gt;</span><span class="p">,</span> <span class="o">&lt;&lt;</span><span class="s">&quot;/contents.html&quot;</span><span class="o">&gt;&gt;</span><span class="p">,</span> <span class="p">[],</span> <span class="nv">Client2</span><span class="p">),</span>
</span><span class='line'><span class="p">{</span><span class="n">ok</span><span class="p">,</span> <span class="nv">Status</span><span class="p">,</span> <span class="nv">Headers</span><span class="p">,</span> <span class="nv">Client4</span><span class="p">}</span> <span class="o">=</span> <span class="nn">cowboy_client</span><span class="p">:</span><span class="n">response</span><span class="p">(</span><span class="nv">Client3</span><span class="p">),</span>
</span><span class='line'><span class="p">{</span><span class="n">ok</span><span class="p">,</span> <span class="nv">Body</span><span class="p">,</span> <span class="nv">Client5</span><span class="p">}</span> <span class="o">=</span> <span class="nn">cowboy_client</span><span class="p">:</span><span class="n">response_body</span><span class="p">(</span><span class="nv">Client4</span><span class="p">),</span>
</span></code></pre></td></tr></table></div></figure>


<p>以降でinit/1以外の各行を個別に確認してゆきます。</p>

<h3>接続の確立 (connect/4)</h3>

<p>Transport, Host, Portを指定してコネクションを生成します。
恐らくSSL通信の場合はcowboy_ssl_transportを利用すると思われます。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='erlang'><span class='line'><span class="p">{</span><span class="n">ok</span><span class="p">,</span> <span class="nv">Client2</span><span class="p">}</span> <span class="o">=</span> <span class="nn">cowboy_client</span><span class="p">:</span><span class="n">connect</span><span class="p">(</span><span class="n">cowboy_tcp_transport</span><span class="p">,</span> <span class="s">&quot;localhost&quot;</span><span class="p">,</span> <span class="mi">8080</span><span class="p">,</span> <span class="nv">Client1</span><span class="p">),</span>
</span></code></pre></td></tr></table></div></figure>


<h3>HTTPリクエスト (request/4)</h3>

<p>request関数は３種類用意されています。
リクエストヘッダー、リクエストボディ設定の有無でこれらを使い分けます。</p>

<ul>
<li>request(Method, Url, Client)</li>
<li>request(Method, Url, Headers, Client)</li>
<li>request(Method, Url, Headers, Data, Client)</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='erlang'><span class='line'><span class="p">{</span><span class="n">ok</span><span class="p">,</span> <span class="nv">Client3</span><span class="p">}</span> <span class="o">=</span> <span class="nn">cowboy_client</span><span class="p">:</span><span class="n">request</span><span class="p">(</span><span class="o">&lt;&lt;</span><span class="s">&quot;GET&quot;</span><span class="o">&gt;&gt;</span><span class="p">,</span> <span class="o">&lt;&lt;</span><span class="s">&quot;/contents.html&quot;</span><span class="o">&gt;&gt;</span><span class="p">,</span> <span class="p">[],</span> <span class="nv">Client2</span><span class="p">),</span>
</span></code></pre></td></tr></table></div></figure>


<p>なお、Headerは以下のようなリストで指定します。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='erlang'><span class='line'><span class="p">[{</span><span class="o">&lt;&lt;</span><span class="s">&quot;connection&quot;</span><span class="o">&gt;&gt;</span><span class="p">,</span> <span class="o">&lt;&lt;</span><span class="s">&quot;close&quot;</span><span class="o">&gt;&gt;</span><span class="p">}]</span>
</span></code></pre></td></tr></table></div></figure>


<h3>HTTPレスポンス (response/1, response_body/1)</h3>

<p>ヘッダー、ステータスコードの取得(response/1)とボディの取得(response_body/1)は、個別に行う必要があります。
必要に応じてコールします。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='erlang'><span class='line'><span class="p">{</span><span class="n">ok</span><span class="p">,</span> <span class="nv">Status</span><span class="p">,</span> <span class="nv">Headers</span><span class="p">,</span> <span class="nv">Client4</span><span class="p">}</span> <span class="o">=</span> <span class="nn">cowboy_client</span><span class="p">:</span><span class="n">response</span><span class="p">(</span><span class="nv">Client3</span><span class="p">),</span>
</span><span class='line'><span class="p">{</span><span class="n">ok</span><span class="p">,</span> <span class="nv">Body</span><span class="p">,</span> <span class="p">_</span><span class="nv">Client5</span><span class="p">}</span> <span class="o">=</span> <span class="nn">cowboy_client</span><span class="p">:</span><span class="n">response_body</span><span class="p">(</span><span class="nv">Client4</span><span class="p">),</span>
</span></code></pre></td></tr></table></div></figure>


<p>以上がリクエスト送信からレスポンス受信までの流れです。</p>

<h2>その他</h2>

<h3>POSTリクエスト</h3>

<p>POSTする場合は、request/4を使用してPOSTメソッドの指定、リクエストボディを指定します。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='erlang'><span class='line'><span class="nv">Method</span> <span class="o">=</span> <span class="o">&lt;&lt;</span><span class="s">&quot;POST&quot;</span><span class="o">&gt;&gt;</span><span class="p">,</span>
</span><span class='line'><span class="nv">Url</span> <span class="o">=</span> <span class="o">&lt;&lt;</span><span class="s">&quot;/post_content&quot;</span><span class="o">&gt;&gt;</span><span class="p">,</span>
</span><span class='line'><span class="nv">Headers</span> <span class="o">=</span> <span class="p">[],</span>
</span><span class='line'><span class="nv">Data</span> <span class="o">=</span> <span class="o">&lt;&lt;</span><span class="s">&quot;key=value&quot;</span><span class="o">&gt;&gt;</span>
</span><span class='line'><span class="p">{</span><span class="n">ok</span><span class="p">,</span> <span class="nv">Client3</span><span class="p">}</span> <span class="o">=</span> <span class="nn">cowboy_client</span><span class="p">:</span><span class="n">request</span><span class="p">(</span><span class="nv">Method</span><span class="p">,</span> <span class="nv">Url</span><span class="p">,</span> <span class="nv">Headrs</span><span class="p">,</span> <span class="nv">Data</span><span class="p">,</span> <span class="nv">Client2</span><span class="p">),</span>
</span></code></pre></td></tr></table></div></figure>


<h3>raw_request/2</h3>

<p>cowboy_clientでは生のHTTPリクエストを送信するraw_request/2関数が用意されています。
テスト目的でイレギュラーなHTTPリクエストを送信するときに便利です。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='erlang'><span class='line'><span class="p">{</span><span class="n">ok</span><span class="p">,</span> <span class="nv">Client1</span><span class="p">}</span> <span class="o">=</span> <span class="nn">cowboy_client</span><span class="p">:</span><span class="n">init</span><span class="p">([]),</span>
</span><span class='line'><span class="p">{</span><span class="n">ok</span><span class="p">,</span> <span class="nv">Client2</span><span class="p">}</span> <span class="o">=</span> <span class="nn">cowboy_client</span><span class="p">:</span><span class="n">connect</span><span class="p">(</span><span class="n">cowboy_tcp_transport</span><span class="p">,</span> <span class="s">&quot;localhost&quot;</span><span class="p">,</span> <span class="mi">8080</span><span class="p">,</span> <span class="nv">Client1</span><span class="p">),</span>
</span><span class='line'><span class="p">{</span><span class="n">ok</span><span class="p">,</span> <span class="nv">Client3</span><span class="p">}</span> <span class="o">=</span> <span class="nn">cowboy_client</span><span class="p">:</span><span class="n">raw_request</span><span class="p">(</span><span class="o">&lt;&lt;</span><span class="s">&quot;GET /contents.html HTTP/1.1</span><span class="se">\r\n</span><span class="s">Host: localhost</span><span class="se">\r\n\r\n</span><span class="s">&quot;</span><span class="o">&gt;&gt;</span><span class="p">,</span> <span class="nv">Client2</span><span class="p">),</span>
</span><span class='line'><span class="p">{</span><span class="n">ok</span><span class="p">,</span> <span class="nv">Status</span><span class="p">,</span> <span class="nv">Headers</span><span class="p">,</span> <span class="nv">Client4</span><span class="p">}</span> <span class="o">=</span> <span class="nn">cowboy_client</span><span class="p">:</span><span class="n">response</span><span class="p">(</span><span class="nv">Client3</span><span class="p">),</span>
</span><span class='line'><span class="p">{</span><span class="n">ok</span><span class="p">,</span> <span class="nv">Body</span><span class="p">,</span> <span class="p">_</span><span class="nv">Client5</span><span class="p">}</span> <span class="o">=</span> <span class="nn">cowboy_client</span><span class="p">:</span><span class="n">response_body</span><span class="p">(</span><span class="nv">Client4</span><span class="p">),</span>
</span></code></pre></td></tr></table></div></figure>


<p>以上、大雑把なcowboy_clientの紹介でした。</p>

<p>そもそもcowboyのテストを書くために書かれたモジュールのようなので、
基本的にはHTTP周りのテストを書く際に利用すると良いかと思います。</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/05/04/cowboy/">Cowboyメモ</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-05-04T21:50:00+09:00" pubdate data-updated="true">2012-05-04 21:50</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>CowboyはErlangの軽量Webアプリケーションフレームワークです。
まだドキュメント化されていない部分が多いので軽くメモ。</p>

<h2>基本</h2>

<p>基本的な利用方法は某氏のブログをどうぞ。</p>

<p><a href="http://d.hatena.ne.jp/Voluntas/20120407/1333784371">http://d.hatena.ne.jp/Voluntas/20120407/1333784371</a></p>

<h2>リクエストの処理</h2>

<p>cowboyではhandle/2の引数に<a href="https://github.com/extend/cowboy/blob/master/include/http.hrl">#http_req</a>が渡ってきます。
基本的にはこのhttp_reqをcowboy_http_reqの関数へ渡し、リクエストデータの取得、レスポンスデータの生成を行います。</p>

<h3>レスポンスの送信</h3>

<p>レスポンスの送信にはcowboy_http_req:reply/xを使います。
下記ではステータスコード、レスポンスボディ、レスポンスヘッダーをreply関数へ渡し、
レスポンスを送信しています。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='erlang'><span class='line'><span class="nf">handle</span><span class="p">(</span><span class="nv">Req</span><span class="p">,</span> <span class="nv">State</span><span class="p">)</span> <span class="o">-&gt;</span>
</span><span class='line'>    <span class="nv">StatusCode</span>  <span class="o">=</span> <span class="mi">200</span><span class="p">,</span>
</span><span class='line'>    <span class="nv">Body</span> <span class="o">=</span> <span class="o">&lt;&lt;</span><span class="s">&quot;Hello world!!&quot;</span><span class="o">&gt;&gt;</span><span class="p">,</span>
</span><span class='line'>    <span class="nv">Header</span> <span class="o">=</span> <span class="p">[{</span><span class="n">&#39;Server&#39;</span><span class="p">,</span> <span class="p">[</span><span class="o">&lt;&lt;</span><span class="s">&quot;Hello Cowboy Server!!!&quot;</span><span class="o">&gt;&gt;</span><span class="p">]}],</span>
</span><span class='line'>    <span class="p">{</span><span class="n">ok</span><span class="p">,</span> <span class="nv">Req2</span><span class="p">}</span> <span class="o">=</span> <span class="nn">cowboy_http_req</span><span class="p">:</span><span class="n">reply</span><span class="p">(</span><span class="nv">StatusCode</span><span class="p">,</span> <span class="nv">Header</span><span class="p">,</span> <span class="nv">Body</span><span class="p">,</span> <span class="nv">Req</span><span class="p">),</span>
</span><span class='line'>    <span class="p">{</span><span class="n">ok</span><span class="p">,</span> <span class="nv">Req2</span><span class="p">,</span> <span class="nv">State</span><span class="p">}.</span>
</span></code></pre></td></tr></table></div></figure>


<p>このコードはcowboy_http_reqモジュールのset_resp_xxx関数を使って以下の様に書くこともできます。
ここで新しく生成されるReq_x_には、セットしたレスポンスボディ、レスポンスヘッダーがセットされています。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='erlang'><span class='line'><span class="nf">handle</span><span class="p">(</span><span class="nv">Req</span><span class="p">,</span> <span class="nv">State</span><span class="p">)</span> <span class="o">-&gt;</span>
</span><span class='line'>    <span class="nv">StatusCode</span>  <span class="o">=</span> <span class="mi">200</span><span class="p">,</span>
</span><span class='line'>    <span class="nv">Body</span> <span class="o">=</span> <span class="o">&lt;&lt;</span><span class="s">&quot;Hello world!!&quot;</span><span class="o">&gt;&gt;</span><span class="p">,</span>
</span><span class='line'>    <span class="p">{</span><span class="n">ok</span><span class="p">,</span> <span class="nv">Req1</span><span class="p">}</span> <span class="o">=</span> <span class="nn">cowboy_http_req</span><span class="p">:</span><span class="n">set_resp_body</span><span class="p">(</span><span class="nv">Body</span><span class="p">,</span> <span class="nv">Req</span><span class="p">),</span>
</span><span class='line'>    <span class="p">{</span><span class="n">ok</span><span class="p">,</span> <span class="nv">Req2</span><span class="p">}</span> <span class="o">=</span> <span class="nn">cowboy_http_req</span><span class="p">:</span><span class="n">set_resp_header</span><span class="p">(</span><span class="n">&#39;Server&#39;</span><span class="p">,</span> <span class="o">&lt;&lt;</span><span class="s">&quot;Hello Cowboy Server!!&quot;</span><span class="o">&gt;&gt;</span><span class="p">,</span> <span class="nv">Req1</span><span class="p">),</span>
</span><span class='line'>    <span class="p">{</span><span class="n">ok</span><span class="p">,</span> <span class="nv">Req3</span><span class="p">}</span> <span class="o">=</span> <span class="nn">cowboy_http_req</span><span class="p">:</span><span class="n">reply</span><span class="p">(</span><span class="nv">StatusCode</span><span class="p">,</span> <span class="nv">Req2</span><span class="p">),</span>
</span><span class='line'>    <span class="p">{</span><span class="n">ok</span><span class="p">,</span> <span class="nv">Req3</span><span class="p">,</span> <span class="nv">State</span><span class="p">}.</span>
</span></code></pre></td></tr></table></div></figure>


<h3>URL Queryの取得</h3>

<p>Queryはcowboy_http_req:qs_vals/1, qs_val/2, qs_val/3で取得できます。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='erlang'><span class='line'><span class="nf">handle</span><span class="p">(</span><span class="nv">Req</span><span class="p">,</span> <span class="nv">State</span><span class="p">)</span> <span class="o">-&gt;</span>
</span><span class='line'>    <span class="p">{</span><span class="nv">QsList</span><span class="p">,</span> <span class="nv">Req1</span><span class="p">}</span> <span class="o">=</span> <span class="nn">cowboy_http_req</span><span class="p">:</span><span class="n">qs_vals</span><span class="p">(</span><span class="nv">Req</span><span class="p">),</span>
</span><span class='line'>    <span class="p">...</span>
</span><span class='line'>    <span class="p">{</span><span class="nv">Value</span><span class="p">,</span> <span class="nv">Req1</span><span class="p">}</span> <span class="o">=</span> <span class="nn">cowboy_http_req</span><span class="p">:</span><span class="n">qs_val</span><span class="p">(</span><span class="o">&lt;&lt;</span><span class="s">&quot;key&quot;</span><span class="o">&gt;&gt;</span><span class="p">,</span> <span class="nv">Req</span><span class="p">),</span>
</span><span class='line'>    <span class="p">...</span>
</span><span class='line'>    <span class="p">{</span><span class="nv">ValueOrDefault</span><span class="p">,</span> <span class="nv">Req1</span><span class="p">}</span> <span class="o">=</span> <span class="nn">cowboy_http_req</span><span class="p">:</span><span class="n">qs_val</span><span class="p">(</span><span class="o">&lt;&lt;</span><span class="s">&quot;key&quot;</span><span class="o">&gt;&gt;</span><span class="p">,</span> <span class="nv">Req</span><span class="p">,</span> <span class="nv">DefautVal</span><span class="p">),</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Postデータの取得</h3>

<p>postしたデータはcowboy_http_req:body_qs/1で取得できます。
データはproplistsで返ってきます。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='erlang'><span class='line'><span class="nf">handle</span><span class="p">(</span><span class="nv">Req</span><span class="p">,</span> <span class="nv">State</span><span class="p">)</span> <span class="o">-&gt;</span>
</span><span class='line'>    <span class="p">{</span><span class="nv">QsList</span><span class="p">,</span> <span class="nv">Req1</span><span class="p">}</span> <span class="o">=</span> <span class="nn">cowboy_http_req</span><span class="p">:</span><span class="n">body_qs</span><span class="p">(</span><span class="nv">Req</span><span class="p">),</span>
</span><span class='line'>    <span class="k">case</span> <span class="nn">lists</span><span class="p">:</span><span class="n">keyfind</span><span class="p">(</span><span class="o">&lt;&lt;</span><span class="s">&quot;key&quot;</span><span class="o">&gt;&gt;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="nv">QsList</span><span class="p">)</span> <span class="k">of</span>
</span><span class='line'>        <span class="n">false</span> <span class="o">-&gt;</span>
</span><span class='line'>            <span class="p">...,</span>
</span><span class='line'>        <span class="p">{</span><span class="o">&lt;&lt;</span><span class="s">&quot;key&quot;</span><span class="o">&gt;&gt;</span><span class="p">,</span> <span class="nv">Value</span><span class="p">}</span> <span class="o">-&gt;</span>
</span><span class='line'>            <span class="p">....</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Cookie操作</h2>

<p>cookieの操作も同様にcowboy_http_req:cookie/2, set_resp_cookie/3を使います。</p>

<h3>Cookieの取得</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='erlang'><span class='line'><span class="nf">handle</span><span class="p">(</span><span class="nv">Req</span><span class="p">,</span> <span class="nv">State</span><span class="p">)</span> <span class="o">-&gt;</span>
</span><span class='line'>    <span class="k">case</span> <span class="nn">cowboy_http_req</span><span class="p">:</span><span class="n">cookie</span><span class="p">(</span><span class="nv">Key</span><span class="p">,</span> <span class="nv">Req</span><span class="p">)</span> <span class="k">of</span>
</span><span class='line'>        <span class="p">{</span><span class="n">undefined</span><span class="p">,</span> <span class="nv">Req1</span><span class="p">}</span> <span class="o">-&gt;</span>
</span><span class='line'>            <span class="p">...</span>
</span><span class='line'>        <span class="p">{</span><span class="nv">SessionId</span><span class="p">,</span> <span class="nv">Req1</span><span class="p">}</span> <span class="o">-&gt;</span>
</span><span class='line'>            <span class="p">...</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Cookieのセット</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='erlang'><span class='line'><span class="nf">handle</span><span class="p">(</span><span class="nv">Req</span><span class="p">,</span> <span class="nv">State</span><span class="p">)</span> <span class="o">-&gt;</span>
</span><span class='line'>    <span class="p">{</span><span class="n">ok</span><span class="p">,</span>  <span class="nv">Req1</span><span class="p">}</span> <span class="o">=</span> <span class="nn">cowboy_http_req</span><span class="p">:</span><span class="n">set_resp_cookie</span><span class="p">(</span><span class="o">&lt;&lt;</span><span class="s">&quot;Key&quot;</span><span class="o">&gt;&gt;</span><span class="p">,</span> <span class="o">&lt;&lt;</span><span class="s">&quot;Value&quot;</span><span class="o">&gt;&gt;</span><span class="p">,</span> <span class="p">[</span><span class="n">max_age</span><span class="p">,</span> <span class="mi">1000</span><span class="p">],</span>  <span class="nv">Req</span><span class="p">),</span>
</span><span class='line'>    <span class="p">...</span>
</span></code></pre></td></tr></table></div></figure>


<h2>静的ファイルの処理(cowboy_http_static)</h2>

<p>静的ファイルをレスポンスに利用する場合、
cowboy_http_staticが用意されているので、これを使います。</p>

<p><strong>cowboy_http_staticは2012/05/07現在experimentalです。</strong></p>

<h3>Dispatch設定</h3>

<p>cowboyのlistener起動時に指定するdispatcher設定でcowboy_http_staticをhandlerとして指定します。
そしてOptionにdirectory, mimetypsを指定します。</p>

<p>下記の例では/static/xxxへのアクセスに対してcowboy_http_staticが使用されます。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='erlang'><span class='line'><span class="nv">Dispatch</span> <span class="o">=</span> <span class="p">[</span>
</span><span class='line'>    <span class="p">{</span><span class="n">&#39;_&#39;</span><span class="p">,</span> <span class="p">[</span>
</span><span class='line'>        <span class="p">{[</span><span class="o">&lt;&lt;</span><span class="s">&quot;static&quot;</span><span class="o">&gt;&gt;</span><span class="p">,</span> <span class="n">&#39;...&#39;</span><span class="p">],</span> <span class="n">cowboy_http_static</span><span class="p">,</span> <span class="p">[</span>
</span><span class='line'>                <span class="p">{</span><span class="n">directory</span><span class="p">,</span> <span class="p">{</span><span class="n">priv_dir</span><span class="p">,</span> <span class="n">application_name</span><span class="p">,</span> <span class="p">[</span><span class="o">&lt;&lt;</span><span class="s">&quot;www&quot;</span><span class="o">&gt;&gt;</span><span class="p">]}},</span>
</span><span class='line'>                <span class="p">{</span><span class="n">mimetypes</span><span class="p">,</span> <span class="p">[</span>
</span><span class='line'>                        <span class="p">{</span><span class="o">&lt;&lt;</span><span class="s">&quot;.html&quot;</span><span class="o">&gt;&gt;</span><span class="p">,</span> <span class="p">[</span><span class="o">&lt;&lt;</span><span class="s">&quot;text/html&quot;</span><span class="o">&gt;&gt;</span><span class="p">]},</span>
</span><span class='line'>                        <span class="p">{</span><span class="o">&lt;&lt;</span><span class="s">&quot;.css&quot;</span><span class="o">&gt;&gt;</span><span class="p">,</span>  <span class="p">[</span><span class="o">&lt;&lt;</span><span class="s">&quot;text/css&quot;</span><span class="o">&gt;&gt;</span><span class="p">]},</span>
</span><span class='line'>                        <span class="p">{</span><span class="o">&lt;&lt;</span><span class="s">&quot;.js&quot;</span><span class="o">&gt;&gt;</span><span class="p">,</span>   <span class="p">[</span><span class="o">&lt;&lt;</span><span class="s">&quot;application/javascript&quot;</span><span class="o">&gt;&gt;</span><span class="p">]}]]}]},</span>
</span><span class='line'>        <span class="p">...</span>
</span></code></pre></td></tr></table></div></figure>


<h3>directoryオプション</h3>

<p>静的ファイルのルートディレクトリ。priv_dirを指定すると指定したアプリケーションのprivディレクトリが参照されます。
直接ディレクトリを指定することも可能です。</p>

<p>以下、cowboy_http_staticのedocより</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='erlang'><span class='line'>  <span class="c">%% Serve files from /var/www/ under http://example.com/static/</span>
</span><span class='line'>  <span class="p">{[</span><span class="o">&lt;&lt;</span><span class="s">&quot;static&quot;</span><span class="o">&gt;&gt;</span><span class="p">,</span> <span class="n">&#39;...&#39;</span><span class="p">],</span> <span class="n">cowboy_http_static</span><span class="p">,</span>
</span><span class='line'>      <span class="p">[{</span><span class="n">directory</span><span class="p">,</span> <span class="s">&quot;/var/www&quot;</span><span class="p">}]}</span>
</span><span class='line'>
</span><span class='line'>  <span class="c">%% Serve files from the current working directory under http://example.com/static/</span>
</span><span class='line'>  <span class="p">{[</span><span class="o">&lt;&lt;</span><span class="s">&quot;static&quot;</span><span class="o">&gt;&gt;</span><span class="p">,</span> <span class="n">&#39;...&#39;</span><span class="p">],</span> <span class="n">cowboy_http_static</span><span class="p">,</span>
</span><span class='line'>      <span class="p">[{</span><span class="n">directory</span><span class="p">,</span> <span class="o">&lt;&lt;</span><span class="s">&quot;./&quot;</span><span class="o">&gt;&gt;</span><span class="p">}]}</span>
</span><span class='line'>
</span><span class='line'>  <span class="c">%% Serve files from cowboy/priv/www under http://example.com/</span>
</span><span class='line'>  <span class="p">{[</span><span class="n">&#39;...&#39;</span><span class="p">],</span> <span class="n">cowboy_http_static</span><span class="p">,</span>
</span><span class='line'>      <span class="p">[{</span><span class="n">directory</span><span class="p">,</span> <span class="p">{</span><span class="n">priv_dir</span><span class="p">,</span> <span class="n">cowboy</span><span class="p">,</span> <span class="p">[</span><span class="o">&lt;&lt;</span><span class="s">&quot;www&quot;</span><span class="o">&gt;&gt;</span><span class="p">]}}]}</span>
</span></code></pre></td></tr></table></div></figure>


<h3>mimetypesオプション</h3>

<p>静的ファイルの拡張子毎にConten-Typeを指定します。</p>

<p>Content-Typeのデフォルト値が<em>application/octet-stream</em>になっているので、
適切な値を設定する必要があります。</p>

<p><a href="https://github.com/spawngrid/mimetypes">spawngrid/mimetypes</a>を使うことでmimetypesを、
以下の様にも書ける様です。(未検証)</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='erlang'><span class='line'><span class="p">{</span><span class="n">mimetypes</span><span class="p">,</span> <span class="p">{</span><span class="k">fun</span> <span class="nn">mimetypes</span><span class="p">:</span><span class="n">path_to_mimes</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">default</span><span class="p">}}</span>
</span></code></pre></td></tr></table></div></figure>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/05/02/gitmemo/">Gitメモ</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-05-02T23:29:00+09:00" pubdate data-updated="true">2012-05-02 23:29</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Gitのメモ
git-svnがメインかも…</p>

<h1>git svn</h1>

<table>
<thead>
<tr>
<th> 説明                                     </th>
<th> コマンド</th>
</tr>
</thead>
<tbody>
<tr>
<td> 標準ディレクトリ構成にてクローン         </td>
<td>  git svn clone -s &#8211;prefix=svn/ <em>url</em></td>
</tr>
<tr>
<td> clone時のリビジョン指定(depth)           </td>
<td>  git svn clone -s &#8211;prefix=svn/ -r $REV:HEAD <em>url</em></td>
</tr>
<tr>
<td> svnの変更に追従                          </td>
<td>  git svn rebase</td>
</tr>
<tr>
<td> svnへコミット                            </td>
<td>  git svn dcommit</td>
</tr>
<tr>
<td> svnリポジトリの変更を取得                </td>
<td>  git svn fetch svn</td>
</tr>
<tr>
<td> svn側にブランチ作成                      </td>
<td>  git svn branch <em>branch</em></td>
</tr>
<tr>
<td> svn側にタグ打ち                          </td>
<td>  git svn tag <em>version</em> (-n dry-run)</td>
</tr>
<tr>
<td> svnブランチに紐付くローカルブランチの作成</td>
<td>  git branch <em>local-branch</em> <em>remotes/svn/branch</em></td>
</tr>
<tr>
<td>                                          </td>
<td>  git checkout -b <em>local-branch</em> <em>remotes/svn/branch</em></td>
</tr>
</tbody>
</table>


<h2>merge時の注意</h2>

<p>svnブランチを参照しているブランチからmergeするときは<code>--no-ff</code>オプションを使うこと。fast-fowardだとremoteブランチが切り替わる。
誤って実行した場合はreset等で対処。</p>

<h2>ローカルブランチのコミットを履歴を維持したままsvnブランチへコミットする</h2>

<pre><code>git branch local_branch
// edit &amp; commit
git svn branch remote_branch
git checkout -b svn_sync_branch remotes/svn/remote_branch
git rebase svn_sync_branch
git svn dcommit
</code></pre>

<h1>git flow</h1>

<ul>
<li><a href="https://github.com/nvie/gitflow">git plugin</a></li>
<li><a href="http://nvie.com/posts/a-successful-git-branching-model/">A successful git branching model.</a></li>
<li><a href="http://keijinsonyaban.blogspot.jp/2010/10/successful-git-branching-model.html">日本語訳</a></li>
</ul>


<h2>既存プロジェクトの初期化</h2>

<pre><code>git clone url
git checkout --track origin/master
git flow init
</code></pre>

<p>これをしないとdevelopの変更がlocalのmasterに入ってしまう。</p>

<h2>featureコマンド</h2>

<table>
<thead>
<tr>
<th> 説明                                   </th>
<th> コマンド</th>
</tr>
</thead>
<tbody>
<tr>
<td> featureブランチ作成                    </td>
<td>  git flow feature start <em>branch</em></td>
</tr>
<tr>
<td> featureブランチ終了(developへのmerge)  </td>
<td>  git flow feature finish <em>branch</em></td>
</tr>
<tr>
<td> featureブランチをpush                  </td>
<td>  git flow feature publish <em>branch</em></td>
</tr>
<tr>
<td> featureブランチのpull                  </td>
<td>  git flow feature pull origin <em>branch</em></td>
</tr>
</tbody>
</table>


<h1>その他</h1>

<h2>commit</h2>

<pre><code>git commit -m msg
git commit --amend
</code></pre>

<h2>checkout</h2>

<pre><code>git checkout -b branch_name
git checkout -b branch_name origin/branch
</code></pre>

<h2>rm</h2>

<p>remove from index</p>

<pre><code>git rm --cached item
</code></pre>

<h2>reset</h2>

<pre><code>git reset .
git reset --soft HEAD^
git reset --hard HEAD^
</code></pre>

<h2>rebase</h2>

<pre><code>rebase -i HEAD^^^
rebase --onto base_branch current_branch branch
</code></pre>

<h2>git reflog</h2>

<table>
<thead>
<tr>
<th>説明                 </th>
<th> コマンド</th>
</tr>
</thead>
<tbody>
<tr>
<td>rebase前の情報を取得 </td>
<td>  git reflog show <em>branch</em></td>
</tr>
</tbody>
</table>


<h2>git clean</h2>

<table>
<thead>
<tr>
<th> 説明               </th>
<th> コマンド</th>
</tr>
</thead>
<tbody>
<tr>
<td> .gitignoreを無視   </td>
<td>   git clean -x</td>
</tr>
<tr>
<td> ディレクトリも削除 </td>
<td>   git clean -d</td>
</tr>
</tbody>
</table>


<h2>change author and commiter</h2>

<pre><code>git filter-branch --commit-filter '
if [ "$GIT_COMMITTER_NAME" = "old_name" ]; then
    GIT_AUTHOR_NAME="new_author_name"
    GIT_AUTHOR_EMAIL="new_author_email"
    GIT_COMMITTER_NAME="new_comitter_name"
    GIT_COMMITTER_EMAIL="new_commiter_email"
fi
git commit-tree "$@"
' HEAD
</code></pre>

<p>参考：<a href="http://d.hatena.ne.jp/idesaku/20090908/1252419890">http://d.hatena.ne.jp/idesaku/20090908/1252419890</a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/04/21/erlang-dev-memo/">Erlangと周辺技術のメモ</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-04-21T20:40:00+09:00" pubdate data-updated="true">2012-04-21 20:40</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>gistのメモを移行</p>

<h2>gen_server</h2>

<h3>trace debug</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='erlang'><span class='line'><span class="nn">gen_server</span><span class="p">:</span><span class="n">start_link</span><span class="p">({</span><span class="n">local</span><span class="p">,</span> <span class="no">?SERVER</span><span class="p">},</span> <span class="no">?MODULE</span><span class="p">,</span> <span class="p">[],</span> <span class="p">[{</span><span class="n">debug</span><span class="p">,[</span><span class="nb">trace</span><span class="p">]}])</span>
</span></code></pre></td></tr></table></div></figure>


<h2>rebar</h2>

<h3>dependencies in rebar.config</h3>

<figure class='code'><figcaption><span>rebar.config </span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='erlang'><span class='line'><span class="p">{</span><span class="n">deps</span><span class="p">,</span> <span class="p">[</span>
</span><span class='line'>  <span class="p">{</span><span class="n">webmachine</span><span class="p">,</span> <span class="s">&quot;1.9.0&quot;</span><span class="p">,</span> <span class="p">{</span><span class="n">git</span><span class="p">,</span> <span class="s">&quot;https://github.com/basho/webmachine.git&quot;</span><span class="p">,</span> <span class="p">{</span><span class="n">tag</span><span class="p">,</span><span class="s">&quot;1.9.0&quot;</span><span class="p">}}}</span>
</span><span class='line'><span class="p">]}.</span>
</span></code></pre></td></tr></table></div></figure>


<h3>generate skelton codes</h3>

<ul>
<li>./rebar create-app appid=xxx</li>
<li>./rebar create template=simplemod modid=xxx</li>
<li>./rebar create template=simplesrv srvid=xxx_serve</li>
</ul>


<h3>packaging</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>mkdir rel
</span><span class='line'><span class="nb">cd </span>rel
</span><span class='line'>../rebar create-node <span class="nv">nodeid</span><span class="o">=</span>ememcached
</span><span class='line'>../rebar generate
</span></code></pre></td></tr></table></div></figure>


<p>see: <a href="https://github.com/basho/rebar/tree/master/priv/templates">https://github.com/basho/rebar/tree/master/priv/templates</a></p>

<h2>dialyzer</h2>

<p>Static analysis tool. <a href="http://www.erlang.org/doc/man/dialyzer.html">http://www.erlang.org/doc/man/dialyzer.html</a></p>

<h3>build plt file</h3>

<pre><code>dialyzer --build_plt --apps erts kernel stdlib
</code></pre>

<h3>extend plt file</h3>

<pre><code>dialyzer --add_to_plt --apps mnesia
</code></pre>

<h3>analyse sources</h3>

<pre><code>dialyzer --src src/*.erl
</code></pre>

<h2>typer</h2>

<p>Type anotator.</p>

<h3>show type</h3>

<pre><code>typer -I include src/*.erl
</code></pre>

<h3>insert type into the erlang codes.</h3>

<pre><code>typer --annotate -I include src/*.erl
</code></pre>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/04/07/erlang-acceptor-pool/">Erlang/OTPを利用したAcceptor Poolの実装</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-04-07T16:19:00+09:00" pubdate data-updated="true">2012-04-07 16:19</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>サーバを実装する際にはpreforkモデル云々でacceptor pool(worker pool?)を実装する事がある。
これをErlang/OTPで実装するにあたり、いくつかのOSSコードを参考にさせて頂いた。
これはその参考にさせて貰ったMochiweb, Kaiのacceptor pool実装に関するメモ。</p>

<h2><a href="https://github.com/mochi/mochiweb">Mochiweb</a></h2>

<p>MochiwebはMochi Media, Inc.が公開しているのErlang製の軽量Http Server.というかWeb Framework。</p>

<p>mochiwebではproc_libを使ってacceptor poolを実装している。
acceptorがクラッシュしてもsupervisorに頼らずに直接再起動をする実装がなされている。</p>

<p>MochiwebのCall sequence.<a href="https://gist.github.com/1981423#file_mochiweb.jpg">拡大図</a>
<img src="https://raw.github.com/gist/1981423/11f3715f369203dcbc3ecb9d06efb4639d5ceee4/mochiweb.jpg" width="1134" height="597" title="mochiweb call sequence" ></p>

<p>実際にacceptor poolを生成しているのはmochiweb_socket_server:new_acceptor_pool/2。
ここでmochiweb_acceptor経由でproc_lib:spawn_link/3を連続的に実行することでacceptor poolを生成している。</p>

<figure class='code'><figcaption><span>mochiweb_socket_server:new_acceptor_pool/1  </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='erlang'><span class='line'><span class="nf">new_acceptor_pool</span><span class="p">(</span><span class="nv">Listen</span><span class="p">,</span>
</span><span class='line'>                  <span class="nv">State</span><span class="o">=</span><span class="nl">#mochiweb_socket_server</span><span class="p">{</span><span class="n">acceptor_pool</span><span class="o">=</span><span class="nv">Pool</span><span class="p">,</span>
</span><span class='line'>                                                <span class="n">acceptor_pool_size</span><span class="o">=</span><span class="nv">Size</span><span class="p">,</span>
</span><span class='line'>                                                <span class="n">loop</span><span class="o">=</span><span class="nv">Loop</span><span class="p">})</span> <span class="o">-&gt;</span>
</span><span class='line'>    <span class="nv">F</span> <span class="o">=</span> <span class="k">fun</span> <span class="p">(_,</span> <span class="nv">S</span><span class="p">)</span> <span class="o">-&gt;</span>
</span><span class='line'>                <span class="nv">Pid</span> <span class="o">=</span> <span class="nn">mochiweb_acceptor</span><span class="p">:</span><span class="n">start_link</span><span class="p">(</span><span class="n">self</span><span class="p">(),</span> <span class="nv">Listen</span><span class="p">,</span> <span class="nv">Loop</span><span class="p">),</span>
</span><span class='line'>                <span class="nn">sets</span><span class="p">:</span><span class="n">add_element</span><span class="p">(</span><span class="nv">Pid</span><span class="p">,</span> <span class="nv">S</span><span class="p">)</span>
</span><span class='line'>        <span class="k">end</span><span class="p">,</span>
</span><span class='line'>    <span class="nv">Pool1</span> <span class="o">=</span> <span class="nn">lists</span><span class="p">:</span><span class="n">foldl</span><span class="p">(</span><span class="nv">F</span><span class="p">,</span> <span class="nv">Pool</span><span class="p">,</span> <span class="nn">lists</span><span class="p">:</span><span class="n">seq</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nv">Size</span><span class="p">)),</span>
</span><span class='line'>    <span class="nv">State</span><span class="nl">#mochiweb_socket_server</span><span class="p">{</span><span class="n">acceptor_pool</span><span class="o">=</span><span class="nv">Pool1</span><span class="p">}.</span>
</span></code></pre></td></tr></table></div></figure>


<p>acceptorがクラッシュした場合にはmochiweb_server_socketでクラッシュのメッセージを受け取り、
ここでacceptorを起動する仕組みになっている。当然、process_flag(trap_exit, true)は事前に呼ばれている。</p>

<h2><a href="http://sourceforge.net/projects/kai/develop">Kai</a></h2>

<p>国産のErlangで実装されたKVS. Amazon Dynamoクローン。<a href="http://www.slideshare.net/takemaru/kai-an-open-source-implementation-of-amazons-dynamo-in-japanese">slideshare</a></p>

<p>Kaiはsupervisorを利用してacceptor poolを実装している。supervisor:start_linkにacceptorの定義をリストにして渡すことで、
supervisorのworkerとしてacceptorを多数起動し、これによりpoolを実現している。当然、acceptorの再起動もSupervisor任せである。</p>

<p>acceptor定義のListを生成しているのは以下のkai_tcp_sup:acceptor_spec/6である。</p>

<figure class='code'><figcaption><span>kai_tcp_server_sup:acceptor_specs/6  </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
</pre></td><td class='code'><pre><code class='erlang'><span class='line'><span class="nf">acceptor_specs</span><span class="p">(</span>
</span><span class='line'>  <span class="nv">ListenSocket</span><span class="p">,</span> <span class="nv">State</span><span class="p">,</span> <span class="p">{</span><span class="nv">Dest</span><span class="p">,</span> <span class="nv">Name</span><span class="p">},</span> <span class="nv">MonitorBaseName</span><span class="p">,</span> <span class="nv">Mod</span><span class="p">,</span> <span class="nv">Option</span>
</span><span class='line'><span class="p">)</span> <span class="o">-&gt;</span>
</span><span class='line'>    <span class="nl">#tcp_server_option</span><span class="p">{</span>
</span><span class='line'>        <span class="n">max_processes</span> <span class="o">=</span> <span class="nv">MaxProcesses</span><span class="p">,</span>
</span><span class='line'>        <span class="n">shutdown</span>      <span class="o">=</span> <span class="nv">Shutdown</span>
</span><span class='line'>    <span class="p">}</span> <span class="o">=</span> <span class="nv">Option</span><span class="p">,</span>
</span><span class='line'>    <span class="nv">MonitorName</span> <span class="o">=</span> <span class="k">case</span> <span class="nv">Dest</span> <span class="k">of</span>
</span><span class='line'>      <span class="n">local</span>   <span class="o">-&gt;</span> <span class="nv">MonitorBaseName</span><span class="p">;</span>
</span><span class='line'>      <span class="p">_</span><span class="nv">Global</span> <span class="o">-&gt;</span> <span class="p">{</span><span class="nv">Dest</span><span class="p">,</span> <span class="nv">MonitorBaseName</span><span class="p">}</span>
</span><span class='line'>    <span class="k">end</span><span class="p">,</span>
</span><span class='line'>    <span class="nn">lists</span><span class="p">:</span><span class="n">map</span><span class="p">(</span>
</span><span class='line'>        <span class="k">fun</span> <span class="p">(</span><span class="nv">N</span><span class="p">)</span> <span class="o">-&gt;</span>
</span><span class='line'>            <span class="nv">AcceptorName</span> <span class="o">=</span> <span class="n">build_acceptor_name</span><span class="p">(</span><span class="nv">Name</span><span class="p">,</span> <span class="nv">N</span><span class="p">),</span>
</span><span class='line'>            <span class="p">{</span>
</span><span class='line'>                <span class="nv">AcceptorName</span><span class="p">,</span>
</span><span class='line'>                <span class="p">{</span>
</span><span class='line'>                    <span class="n">kai_tcp_server_acceptor</span><span class="p">,</span>
</span><span class='line'>                    <span class="n">start_link</span><span class="p">,</span>
</span><span class='line'>                    <span class="p">[</span>
</span><span class='line'>                        <span class="p">{</span><span class="nv">Dest</span><span class="p">,</span> <span class="nv">AcceptorName</span><span class="p">},</span>
</span><span class='line'>                        <span class="nv">ListenSocket</span><span class="p">,</span>
</span><span class='line'>                        <span class="nv">State</span><span class="p">,</span>
</span><span class='line'>                        <span class="nv">MonitorName</span><span class="p">,</span>
</span><span class='line'>                        <span class="nv">Mod</span><span class="p">,</span>
</span><span class='line'>                        <span class="nv">Option</span>
</span><span class='line'>                    <span class="p">]</span>
</span><span class='line'>                <span class="p">},</span>
</span><span class='line'>                <span class="n">permanent</span><span class="p">,</span>
</span><span class='line'>                <span class="nv">Shutdown</span><span class="p">,</span>
</span><span class='line'>                <span class="n">worker</span><span class="p">,</span>
</span><span class='line'>                <span class="p">[]</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>        <span class="k">end</span><span class="p">,</span>
</span><span class='line'>        <span class="nn">lists</span><span class="p">:</span><span class="n">seq</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nv">MaxProcesses</span><span class="p">)</span>
</span><span class='line'>    <span class="p">).</span>
</span></code></pre></td></tr></table></div></figure>


<h2>まとめ</h2>

<h3>Acceptorの生成</h3>

<ul>
<li>Mochiweb: proc_libで個別に起動</li>
<li>kai: supervisor任せ</li>
</ul>


<h3>Acceptorの再起動</h3>

<ul>
<li>Mochiweb: 自前実装</li>
<li>kai: supervisor任せ</li>
</ul>


<p>なんか他のコードも読んだ気がしたけど、すっかり忘れてしまったので以上２つだけのまとめ。</p>

<p>ちなみに自分が実装する際にはKaiの方式を利用させて貰った。Supervisor便利である。</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/04/07/sbt-usage/">Sbt</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-04-07T15:00:00+09:00" pubdate data-updated="true">2012-04-07 15:00</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>簡単にメモ</p>

<h2><a href="https://github.com/harrah/xsbt/wiki">simple build tool (version 0.11.x)</a></h2>

<p>scalaのビルドツール。
最近のバージョンでは基本的に対話モードで利用する雰囲気。</p>

<h2>よく使うコマンド</h2>

<table>
<thead>
<tr>
<th>コマンド名               </th>
<th> 説明</th>
</tr>
</thead>
<tbody>
<tr>
<td>update                   </td>
<td> ライブラリ(dependenciew)取得</td>
</tr>
<tr>
<td>clean                    </td>
<td> cleanup target directories</td>
</tr>
<tr>
<td>run                      </td>
<td> main classの検索、一覧表示からの実行</td>
</tr>
<tr>
<td>run-main <em>classname</em> 　  </td>
<td> main classを明示的に指定して実行</td>
</tr>
<tr>
<td>console                  </td>
<td> scalaの対話型コンソール起動。:quitでconsoleから抜ける</td>
</tr>
<tr>
<td>tasks                    </td>
<td> タスク一覧表示</td>
</tr>
<tr>
<td>package                  </td>
<td> パッケージ(jar)の生成</td>
</tr>
</tbody>
</table>


<p>コマンドがよく分からなかったらtasksでコマンド一覧をながめて、help引いて使えばなんとかなる。</p>

<h2>usage</h2>

<ol>
<li>sbtを起動(基本起動させっぱなし)</li>
<li>consoleコマンドでREPL起動。コードの動作を確認しつつ、別windowで編集(vim)</li>
<li>書いたらcompileでビルド</li>
<li>run、もしくはrun-mainで実行</li>
</ol>


<p>という雰囲気で使ってる。</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/04/01/building-vim/">Vimのビルド</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-04-01T21:47:00+09:00" pubdate data-updated="true">2012-04-01 21:47</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>ビルドオプションを忘れるのでメモ。mercurialのメモだったりもする。</p>

<pre><code>hg clone https://vim.googlecode.com/hg/ vim
cd vim
hg update v7-3-487
./configure --prefix=/usr/local/vim-7.3.487 --with-features=huge --enable-multibyte --enable-pythoninterp --enable-rubyinterp
make &amp;&amp; make install
cd /usr/local
ln -s vim-7.3.487 vim
</code></pre>

<h3>misc</h3>

<p>tagの確認</p>

<pre><code>hg tags
</code></pre>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/03/30/perlbrew/">Setup Perlbrew and Cpanminus.</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-03-30T19:38:00+09:00" pubdate data-updated="true">2012-03-30 19:38</time>
        
      </p>
    
  </header>


  <div class="entry-content"><h1>perlbrew</h1>

<p><a href="http://perlbrew.pl/">http://perlbrew.pl/</a></p>

<p>install perlbrew into <em>$HOME/.perlbrew</em> (default install path is <em>$HOME/perl5</em>)</p>

<pre><code>echo "export PERLBREW_ROOT=$HOME/.perlbrew" &gt;&gt; .zshrc
curl -kL http://install.perlbrew.pl | bash
echo "[[ -s ~/.perlbrew/etc/bashrc ]] &amp;&amp; source ~/.perlbrew/etc/bashrc" &gt;&gt; .zshrc

perlbrew install perl-5.15.9
perlbrew switch perl-5.15.9
</code></pre>

<h1>cpanminus</h1>

<p><a href="https://github.com/miyagawa/cpanminus">https://github.com/miyagawa/cpanminus</a></p>

<p>install cpanm</p>

<pre><code>perlbrew install-cpanm
</code></pre>

<p>install module</p>

<pre><code>cpanm module_name
</code></pre>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/03/23/rbenv-ruby-build-rbenv-gemset/">Rbenv Ruby-build Rbenv-gemsetのセットアップ</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-03-23T21:53:00+09:00" pubdate data-updated="true">2012-03-23 21:53</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>近頃、RVMはオワコン呼ばわりされているので、rbenvを使ってます。
Linuxへのインストール手順のまとめが見当たらなかったのでまとめておきます。</p>

<h1>MacOS</h1>

<pre><code>sudo brew install rbenv ruby-build rbenv-gemset
</code></pre>

<h2>rbenv with homebrew&#8217;s readline</h2>

<p>参考： <a href="http://blog.twiwt.org/e/66a1d0">http://blog.twiwt.org/e/66a1d0</a></p>

<pre><code>brew install readline
brew link readline
CONFIGURE_OPTS="--with-readline-dir=/usr/local" rbenv install 1.9.2-p290
</code></pre>

<h1>Linux</h1>

<h2>install rbenv</h2>

<p>ダウンロード</p>

<pre><code>cd
git clone git://github.com/sstephenson/rbenv.git .rbenv
</code></pre>

<p>シェルの設定(zsh)</p>

<pre><code>echo 'export PATH="$HOME/.rbenv/bin:$PATH"' &gt;&gt; ~/.zshrc
echo 'eval "$(rbenv init -)"' &gt;&gt; ~/.zshrc
source ~/.zshrc
</code></pre>

<p><em>bashの場合は ~/.bash_profileへ設定する.</em></p>

<h3>system wide install</h3>

<p>System wideでインストールする場合には /usr/local/rbenv へインストールします。</p>

<pre><code>cd /usr/local
git clone git://github.com/sstephenson/rbenv.git
</code></pre>

<p>初期設定は /etc/profile.d/rbenv.sh へいれます。</p>

<pre><code>echo 'export PATH="/usr/local/rbenv/bin:$PATH"' &gt;&gt; /etc/profile.d/rbenv.sh
echo 'eval "$(rbenv init -)"' &gt;&gt; /etc/profile.d/rbenv.sh
</code></pre>

<p>参考：<a href="https://github.com/sstephenson/rbenv/wiki/shared-install-of-rbenv">shared-install-of-rbenv</a></p>

<h3>trouble shoot</h3>

<p>シェル初期化時に以下のエラーが発生することがある。</p>

<pre><code>$HOME/.rbenv/libexec/../completions/rbenv.bash:14: command not found: complete
</code></pre>

<p>この場合、.zshrcの設定を以下に変更</p>

<pre><code>eval "$(rbenv init - zsh)"
</code></pre>

<h2>install ruby-build</h2>

<pre><code>mkdir -p ~/.rbenv/plugins
cd ~/.rbenv/plugins
git clone git://github.com/sstephenson/ruby-build.git
</code></pre>

<h2>install rbenv-gemset</h2>

<pre><code>mkdir -p ~/.rbenv/plugins
cd ~/.rbenv/plugins
git clone git://github.com/jamis/rbenv-gemset.git
</code></pre>

<h1>Usage</h1>

<h2>install ruby</h2>

<pre><code>rbenv install 1.9.2-p290
rbenv global 1.9.2-p290
rbenv rehash
</code></pre>

<h2>freeze ruby version</h2>

<pre><code>cd your-project-dir
rbenv local 1.9.2-p290
</code></pre>

<h2>make my gemset</h2>

<pre><code>cd your-project-dir
rbenv gemset create 1.9.2-p290 my-gemset 
echo my-gemset &gt; .rbenv-gemsets
</code></pre>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/blog/page/3/">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    
<section>
<img src="http://gravatar.com/avatar/3cb9536d180c2144c16db29a34e2fd39?s=80" alt="ksauzz" title="ksauzz" />
</section>

<section>
  <h1>About Me</h1>
  <p>software engineer.</p>
  <a href="http://about.me/ksauzz">http://about.me/ksauzz</a>
</section>
<section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2013/04/30/redbug/">Erlangのデバッグツール redbug</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/12/12/riak-advent-calendar-2013-07/">ひとりでやる(?)Riak Advent Calendar 2012 day7 - Ruby Clientで遊んでみよう </a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/11/19/how-to-use-vagrant/">Vagrantメモ</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/11/18/shutdown-erl/">erlの停止</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/11/16/setup-php/">PHP環境メモ</a>
      </li>
    
  </ul>
</section>
<section>
  <h1>Tag Cloud</h1>
    <span id="tag-cloud"><a href='/blog/categories/cowboy' style='font-size: 115.0%'>cowboy(2)</a> <a href='/blog/categories/erlang' style='font-size: 160.0%'>erlang(8)</a> <a href='/blog/categories/git' style='font-size: 107.5%'>git(1)</a> <a href='/blog/categories/http' style='font-size: 107.5%'>http(1)</a> <a href='/blog/categories/linux' style='font-size: 107.5%'>linux(1)</a> <a href='/blog/categories/mac' style='font-size: 107.5%'>mac(1)</a> <a href='/blog/categories/objectmapper' style='font-size: 107.5%'>objectmapper(1)</a> <a href='/blog/categories/octopress' style='font-size: 107.5%'>octopress(1)</a> <a href='/blog/categories/perl' style='font-size: 107.5%'>perl(1)</a> <a href='/blog/categories/php' style='font-size: 107.5%'>php(1)</a> <a href='/blog/categories/riak' style='font-size: 107.5%'>riak(1)</a> <a href='/blog/categories/ruby' style='font-size: 122.5%'>ruby(3)</a> <a href='/blog/categories/sbt' style='font-size: 107.5%'>sbt(1)</a> <a href='/blog/categories/scala' style='font-size: 107.5%'>scala(1)</a> <a href='/blog/categories/tool' style='font-size: 107.5%'>tool(1)</a> <a href='/blog/categories/vagrant' style='font-size: 107.5%'>vagrant(1)</a> <a href='/blog/categories/vim' style='font-size: 107.5%'>vim(1)</a> <a href='/blog/categories/zeromq' style='font-size: 107.5%'>zeromq(1)</a> </span>
</section>

<section>
  <h1>Latest Tweets</h1>
  <ul id="tweets">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  <script type="text/javascript">
    $.domReady(function(){
      getTwitterFeed("ksauzz", 4, false);
    });
  </script>
  <script src="/javascripts/twitter.js" type="text/javascript"> </script>
  
    <a href="http://twitter.com/ksauzz" class="twitter-follow-button" data-show-count="false">Follow @ksauzz</a>
  
</section>


<section>
  <h1>On Delicious</h1>
  <div id="delicious"></div>
  <script type="text/javascript" src="http://feeds.delicious.com/v2/json/ksauzz?count=3&amp;sort=date&amp;callback=renderDeliciousLinks"></script>
  <p><a href="http://delicious.com/ksauzz">My Delicious Bookmarks &raquo;</a></p>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  
  <a href="https://github.com/ksauzz">@ksauzz</a> on GitHub
  
  <script type="text/javascript">
    $.domReady(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'ksauzz',
            count: 0,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>

<section>
  <h1>Categories</h1>
    <ul id="category-list"><li><a href='/blog/categories/cowboy'>cowboy (2)</a></li><li><a href='/blog/categories/erlang'>erlang (8)</a></li><li><a href='/blog/categories/git'>git (1)</a></li><li><a href='/blog/categories/http'>http (1)</a></li><li><a href='/blog/categories/linux'>linux (1)</a></li><li><a href='/blog/categories/mac'>mac (1)</a></li><li><a href='/blog/categories/objectmapper'>objectmapper (1)</a></li><li><a href='/blog/categories/octopress'>octopress (1)</a></li><li><a href='/blog/categories/perl'>perl (1)</a></li><li><a href='/blog/categories/php'>php (1)</a></li><li><a href='/blog/categories/riak'>riak (1)</a></li><li><a href='/blog/categories/ruby'>ruby (3)</a></li><li><a href='/blog/categories/sbt'>sbt (1)</a></li><li><a href='/blog/categories/scala'>scala (1)</a></li><li><a href='/blog/categories/tool'>tool (1)</a></li><li><a href='/blog/categories/vagrant'>vagrant (1)</a></li><li><a href='/blog/categories/vim'>vim (1)</a></li><li><a href='/blog/categories/zeromq'>zeromq (1)</a></li></ul>
</section>

<section>
  <h1>Coderwall</h1>
  <ul id="cw_badges">
    <li class="loading">Status updating&#8230;</li>
  </ul>

  <script type="text/javascript">
    var coderwall = (function(){
      function render(options, badges){
        var fragment = '',
            t = $(options.target)[0],
            height = 65,
            width = 65,
            index;

        for (index in badges) {
          fragment += '<a class="cw_badge"title="' + badges[index].description + '" href="http://coderwall.com/' + options.user + '">';
          fragment +=   '<img alt="' + badges[index].description + '" height="' + width + '" width="' + height + '" src="' + badges[index].badge + '"/>';
          fragment += '</a>';
        }

        t.innerHTML = fragment;
      }
      return {
        showBadges: function(options){
          $.ajax({
              url: 'http://coderwall.com/' + options.user + '.json?callback=?'
            , type: 'jsonp'
            , error: function (err) { $(options.target + ' li.loading').addClass('error').text("Error loading feed"); }
            , success: function(res) {
                render(options, res.data.badges);
            }
          });
        }
      };
    })();

    $.domReady(function(){
      if (!window.jXHR){
        var jxhr = document.createElement('script');
        jxhr.type = 'text/javascript';
        jxhr.src = '/javascripts/libs/jXHR.js';
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(jxhr, s);
      }
      if (!window.$){
        var b = document.createElement('script');
        b.type = 'text/javascript';
        b.src = '/javascripts/ender.js';
        var sc = document.getElementsByTagName('script')[0];
        sc.parentNode.insertBefore(jxhr, s);
      }
      coderwall.showBadges({
        user: 'ksauzz',
        target: '#cw_badges'
      });
    });
  </script>
  <style type="text/css">
    .cw_badge img {
      padding: 5px;
      border: 0 none !important;
      -moz-box-shadow: none !important;
      -webkit-box-shadow: none !important;
      -o-box-shadow: none !important;
      box-shadow: none !important;
    }
  </style>
</section>





  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2021 - ksauzz -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'ksauzz-octopress';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>





  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
